#!/bin/bash

cat >>~admin/.3cfg <<EOF
[default]
access_key = <%= aws_access_key %>
secret_key = <%= aws_secret_key %>
EOF

curl -o /home/admin/audio_worker/runner.rb <%= runner_endpoint %>

su -c 'INSTANCE=<%= client_token %> INSTANCE_ENDPOINT=<%= instance_endpoint %> QUEUE_ENDPOINT=<%= queue_endpoint %> ruby /home/admin/audio_worker/runner.rb' admin

# https://stackoverflow.com/questions/10541363/self-terminating-aws-ec2-instance
echo Done. Shutting down...
#shutdown -h now
