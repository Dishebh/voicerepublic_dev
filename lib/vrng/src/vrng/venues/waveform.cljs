(ns vrng.venues.waveform)

(defn get-volume-line
  [length count idx volume]
  (let [x-coord (* idx 3)]
   [:line {:x1 x-coord :y1 (- 100 (* volume 100)) :x2 x-coord :y2 (+ 100 (* volume 100)) :stroke-width 2 :stroke "black"}])
  )

(defn waveform-svg
  "returns actual svg waveform component"
  [{left :left right :right length :length}]
  [:svg {:x 0 :y 0 :width 300 :height 200}
   (let [volume-points (mapv + right left)]
   (map-indexed (partial get-volume-line length (count volume-points)) volume-points))
   ])

(def json-test-string
  "{\r\n  \"left\": [0.00067,0.00046,0.00055,0.00079,0.00067,0.00067,0.00055,0.00067,0.00079,0.00067,0.00055,0.00055,0.00079,0.00079,0.00079,0.00046,0.00067,0.00067,0.00055,0.00055,0.00067,0.00055,0.00055,0.00079,0.00055,0.00055,0.00079,0.00067,0.00067,0.00055,0.00055,0.00067,0.00067,0.00055,0.00079,0.00067,0.00079,0.00055,0.00067,0.00067,0.00067,0.00067,0.00079,0.00055,0.029,0.13,0.25,0.25,0.25,0.19,0.31,0.21,0.35,0.19,0.17,0.38,0.23,0.37,0.19,0.18,0.35,0.18,0.33,0.34,0.15,0.33,0.15,0.2,0.31,0.14,0.29,0.14,0.13,0.31,0.16,0.31,0.22,0.16,0.25,0.13,0.2,0.28,0.15,0.29,0.13,0.17,0.29,0.15,0.27,0.11,0.13,0.27,0.14,0.19,0.26,0.16,0.27,0.13,0.16,0.23,0.13,0.21,0.14,0.13,0.22,0.15,0.22,0.19,0.14,0.2,0.14,0.18,0.2,0.14,0.19,0.11,0.15,0.18,0.14,0.18,0.14,0.14,0.17,0.14,0.16,0.17,0.13,0.17,0.13,0.15,0.17,0.15,0.18,0.13,0.13,0.16,0.092,0.3,0.33,0.6,0.41,0.55,0.47,0.54,0.52,0.48,0.41,0.36,0.47,0.38,0.5,0.26,0.4,0.5,0.38,0.47,0.31,0.35,0.46,0.32,0.32,0.45,0.31,0.46,0.31,0.32,0.46,0.33,0.46,0.15,0.32,0.41,0.3,0.41,0.45,0.3,0.44,0.29,0.3,0.46,0.35,0.45,0.16,0.35,0.44,0.34,0.44,0.25,0.33,0.45,0.27,0.33,0.45,0.32,0.43,0.22,0.33,0.43,0.3,0.44,0.15,0.28,0.4,0.22,0.41,0.42,0.3,0.41,0.21,0.3,0.4,0.29,0.41,0.16,0.28,0.41,0.27,0.4,0.14,0.28,0.38,0.16,0.29,0.39,0.25,0.36,0.16,0.26,0.35,0.23,0.36,0.11,0.22,0.32,0.19,0.32,0.27,0.21,0.32,0.14,0.21,0.3,0.21,0.31,0.16,0.21,0.29,0.22,0.28,0.12,0.23,0.27,0.12,0.23,0.26,0.19,0.25,0.13,0.19,0.25,0.27,0.53,0.28,0.28,0.33,0.28,0.43,0.27,0.24,0.31,0.24,0.33,0.44,0.26,0.33,0.21,0.3,0.43,0.26,0.31,0.21,0.3,0.41,0.26,0.42,0.42,0.25,0.4,0.32,0.51,0.32,0.32,0.35,0.44,0.36,0.37,0.38,0.3,0.38,0.47,0.26,0.37,0.3,0.45,0.42,0.35,0.37,0.35,0.59,0.48,0.43,0.46,0.53,0.45,0.46,0.48,0.33,0.59,0.36,0.35,0.55,0.29,0.51,0.32,0.3,0.4,0.42,0.4,0.4,0.34,0.37,0.5,0.3,0.51,0.29,0.32,0.54,0.27,0.3,0.5,0.29,0.44,0.28,0.28,0.36,0.27,0.3,0.33,0.23,0.4,0.45,0.4,0.57,0.41,0.35,0.54,0.39,0.51,0.41,0.4,0.4,0.41,0.23,0.36,0.44,0.32,0.41,0.39,0.28,0.39,0.24,0.36,0.38,0.26,0.31,0.28,0.29,0.35,0.26,0.25,0.3,0.17,0.29,0.28,0.17,0.29,0.27,0.29,0.29,0.19,0.27,0.29,0.22,0.28,0.23,0.23,0.32,0.19,0.3,0.22,0.2,0.33,0.18,0.17,0.29,0.2,0.29,0.17,0.13,0.25,0.21,0.21,0.19,0.17,0.17,0.23,0.13,0.23,0.13,0.12,0.23,0.13,0.14,0.2,0.12,0.2,0.14,0.12,0.16,0.11,0.12,0.13,0.13,0.14,0.11,0.093,0.13,0.13,0.11,0.14,0.086,0.11,0.16,0.093,0.14,0.14,0.099,0.17,0.082,0.086,0.14,0.094,0.15,0.079,0.083,0.12,0.075,0.12,0.056,0.087,0.099,0.072,0.083,0.093,0.092,0.08,0.07,0.081,0.078,0.082,0.078,0.06,0.068,0.087,0.073,0.074,0.074,0.068,0.078,0.072,0.065,0.069,0.055,0.14,0.14,0.21,0.22,0.24,0.29,0.31,0.25,0.25,0.26,0.22,0.25,0.2,0.2,0.23,0.19,0.21,0.2,0.19,0.18,0.16,0.19,0.16,0.16,0.17,0.16,0.16,0.15,0.16,0.15,0.15,0.13,0.14,0.15,0.14,0.14,0.15,0.13,0.14,0.13,0.13,0.13,0.12,0.13,0.12,0.11,0.12,0.1,0.11,0.11,0.1,0.11,0.11,0.1,0.1,0.099,0.097,0.12,0.081,0.11,0.1,0.091,0.11,0.1,0.1,0.096,0.084,0.11,0.094,0.083,0.093,0.076,0.093,0.08,0.072,0.082,0.072,0.08,0.071,0.067,0.07,0.067,0.062,0.062,0.069,0.057,0.062,0.054,0.057,0.062,0.056,0.056,0.057,0.057,0.057,0.06,0.053,0.058,0.055,0.049,0.058,0.046,0.046,0.054,0.046,0.052,0.047,0.046,0.051,0.042,0.046,0.048,0.042,0.043,0.051,0.042,0.047,0.037,0.039,0.046,0.035,0.044,0.032,0.033,0.042,0.036,0.038,0.035,0.034,0.035,0.035,0.027,0.038,0.031,0.031,0.037,0.034,0.035,0.031,0.026,0.034,0.032,0.024,0.032,0.025,0.03,0.033,0.023,0.029,0.022,0.028,0.03,0.022,0.024,0.028,0.024,0.027,0.021,0.022,0.024,0.023,0.023,0.02,0.022,0.02,0.016,0.022,0.02,0.021,0.015,0.019,0.019,0.018,0.019,0.016,0.017,0.017,0.018,0.017,0.017,0.016,0.016,0.016,0.014,0.016,0.014,0.014,0.016,0.014,0.014,0.014,0.012,0.013,0.015,0.012,0.015,0.01,0.012,0.015,0.011,0.014,0.01,0.011,0.013,0.0099,0.011,0.012,0.011,0.011,0.01,0.01,0.011,0.0099,0.01,0.01,0.0094,0.0099,0.01,0.0088,0.01,0.0088,0.0092,0.01,0.0069,0.0082,0.0087,0.0084,0.009,0.007,0.0078,0.009,0.0079,0.0066,0.0089,0.007,0.0089,0.0067,0.0065,0.0088,0.0076,0.0086,0.0057,0.0067,0.0078,0.0073,0.0062,0.0077,0.007,0.0069,0.0052,0.007,0.0067,0.0064,0.0065,0.0047,0.006,0.0056,0.0056,0.0058,0.0041,0.0052,0.006,0.0057,0.0056,0.0052,0.0056,0.0057,0.006,0.0055,0.0055,0.0057,0.0052,0.0038,0.0054,0.0047,0.0047,0.0038,0.0033,0.0037,0.0032,0.0027,0.0018,0.0023,0.0024,0.0018,0.0019,0.0018,0.0017,0.0016,0.0016,0.0014,0.0016,0.0014,0.0015,0.0014,0.0013,0.0015,0.0013,0.001,0.0013,0.0014,0.001,0.0011,0.0011,0.001,0.0014,0.001,0.0011,0.00079,0.00079,0.0011,0.0011,0.001,0.00079,0.00079,0.001,0.00079],\r\n  \"right\": [0.00055,0.00046,0.00055,0.00055,0.00055,0.00055,0.00046,0.00055,0.00055,0.00055,0.00055,0.00046,0.00055,0.00055,0.00067,0.00034,0.00055,0.00055,0.00055,0.00046,0.00046,0.00046,0.00055,0.00067,0.00046,0.00034,0.00055,0.00067,0.00046,0.00046,0.00046,0.00055,0.00046,0.00046,0.00046,0.00067,0.00055,0.00055,0.00067,0.00055,0.00055,0.00055,0.00055,0.00046,0.031,0.15,0.34,0.28,0.28,0.25,0.32,0.36,0.26,0.34,0.26,0.23,0.25,0.24,0.29,0.26,0.25,0.28,0.2,0.24,0.25,0.19,0.22,0.16,0.15,0.21,0.18,0.18,0.18,0.16,0.24,0.16,0.22,0.18,0.19,0.22,0.19,0.17,0.19,0.19,0.18,0.17,0.17,0.18,0.21,0.19,0.17,0.2,0.17,0.2,0.19,0.17,0.17,0.17,0.19,0.15,0.18,0.21,0.14,0.18,0.14,0.14,0.17,0.13,0.16,0.18,0.16,0.15,0.11,0.15,0.18,0.13,0.16,0.12,0.16,0.15,0.16,0.15,0.15,0.14,0.15,0.14,0.15,0.16,0.14,0.16,0.1,0.16,0.14,0.13,0.16,0.14,0.19,0.32,0.35,0.41,0.3,0.38,0.4,0.31,0.39,0.38,0.34,0.4,0.37,0.31,0.36,0.26,0.35,0.35,0.28,0.38,0.39,0.38,0.4,0.29,0.37,0.38,0.36,0.43,0.19,0.33,0.45,0.26,0.42,0.39,0.3,0.39,0.25,0.32,0.4,0.35,0.39,0.24,0.33,0.41,0.23,0.41,0.25,0.35,0.39,0.21,0.32,0.4,0.35,0.43,0.24,0.35,0.4,0.31,0.36,0.17,0.29,0.38,0.23,0.37,0.38,0.28,0.37,0.2,0.25,0.34,0.24,0.35,0.18,0.27,0.32,0.2,0.31,0.2,0.26,0.32,0.18,0.28,0.3,0.24,0.29,0.16,0.25,0.32,0.2,0.31,0.18,0.24,0.26,0.17,0.25,0.28,0.21,0.27,0.18,0.2,0.25,0.2,0.23,0.13,0.2,0.23,0.13,0.23,0.14,0.17,0.22,0.14,0.18,0.21,0.17,0.2,0.13,0.17,0.19,0.13,0.21,0.12,0.19,0.21,0.22,0.46,0.3,0.36,0.44,0.39,0.42,0.37,0.4,0.41,0.33,0.36,0.39,0.29,0.38,0.33,0.34,0.37,0.3,0.38,0.37,0.37,0.36,0.36,0.56,0.42,0.38,0.4,0.39,0.46,0.5,0.36,0.31,0.39,0.37,0.42,0.34,0.23,0.36,0.42,0.44,0.27,0.29,0.42,0.32,0.41,0.2,0.32,0.46,0.46,0.49,0.38,0.55,0.45,0.39,0.33,0.32,0.55,0.37,0.37,0.29,0.34,0.54,0.42,0.33,0.32,0.33,0.44,0.38,0.22,0.2,0.38,0.29,0.36,0.28,0.2,0.43,0.28,0.3,0.2,0.27,0.38,0.32,0.28,0.27,0.31,0.38,0.39,0.26,0.36,0.49,0.6,0.48,0.35,0.33,0.41,0.55,0.45,0.35,0.37,0.45,0.33,0.45,0.37,0.42,0.44,0.28,0.32,0.33,0.44,0.4,0.33,0.24,0.32,0.5,0.37,0.28,0.28,0.34,0.44,0.3,0.24,0.25,0.35,0.38,0.27,0.19,0.22,0.31,0.29,0.26,0.27,0.28,0.31,0.27,0.23,0.24,0.32,0.3,0.28,0.24,0.28,0.28,0.23,0.3,0.24,0.29,0.23,0.19,0.27,0.23,0.26,0.29,0.16,0.23,0.19,0.21,0.23,0.17,0.17,0.18,0.21,0.2,0.17,0.18,0.16,0.22,0.17,0.17,0.2,0.16,0.25,0.19,0.15,0.19,0.16,0.24,0.14,0.14,0.19,0.17,0.2,0.15,0.13,0.14,0.21,0.13,0.14,0.14,0.12,0.21,0.12,0.13,0.16,0.14,0.19,0.12,0.1,0.12,0.16,0.15,0.12,0.11,0.14,0.14,0.1,0.1,0.12,0.12,0.1,0.08,0.07,0.12,0.1,0.096,0.064,0.077,0.098,0.11,0.09,0.053,0.071,0.11,0.21,0.23,0.25,0.25,0.31,0.32,0.25,0.26,0.28,0.26,0.28,0.25,0.22,0.25,0.24,0.23,0.23,0.22,0.22,0.21,0.18,0.17,0.2,0.21,0.19,0.17,0.16,0.17,0.19,0.19,0.15,0.15,0.17,0.17,0.17,0.14,0.15,0.16,0.16,0.14,0.15,0.13,0.14,0.14,0.14,0.14,0.13,0.12,0.12,0.11,0.13,0.12,0.12,0.1,0.11,0.11,0.14,0.1,0.1,0.11,0.11,0.12,0.091,0.1,0.11,0.1,0.11,0.11,0.088,0.097,0.11,0.097,0.096,0.084,0.081,0.1,0.086,0.082,0.081,0.074,0.082,0.076,0.065,0.077,0.077,0.074,0.067,0.062,0.067,0.08,0.065,0.061,0.062,0.056,0.076,0.057,0.062,0.06,0.059,0.067,0.053,0.053,0.057,0.054,0.058,0.045,0.052,0.053,0.053,0.051,0.044,0.047,0.053,0.049,0.043,0.043,0.043,0.048,0.043,0.037,0.04,0.045,0.044,0.041,0.034,0.034,0.041,0.039,0.036,0.033,0.033,0.039,0.034,0.033,0.03,0.031,0.035,0.032,0.033,0.03,0.031,0.031,0.029,0.032,0.028,0.034,0.03,0.027,0.03,0.024,0.033,0.029,0.025,0.023,0.023,0.028,0.024,0.022,0.022,0.021,0.025,0.022,0.021,0.022,0.019,0.025,0.022,0.019,0.021,0.022,0.023,0.02,0.019,0.021,0.019,0.019,0.019,0.019,0.02,0.018,0.017,0.016,0.02,0.016,0.017,0.015,0.012,0.018,0.015,0.015,0.014,0.012,0.015,0.014,0.013,0.013,0.012,0.014,0.014,0.014,0.014,0.012,0.014,0.013,0.0099,0.013,0.012,0.01,0.013,0.012,0.012,0.012,0.0088,0.011,0.011,0.011,0.0096,0.011,0.01,0.011,0.012,0.0093,0.012,0.009,0.012,0.011,0.0085,0.013,0.0082,0.012,0.012,0.0078,0.012,0.0088,0.0074,0.011,0.011,0.011,0.008,0.0062,0.01,0.0099,0.0094,0.0069,0.0072,0.0089,0.0081,0.008,0.008,0.0079,0.0084,0.0069,0.0073,0.0076,0.0077,0.0077,0.0057,0.0064,0.0073,0.0072,0.0074,0.005,0.006,0.0064,0.0066,0.0064,0.0071,0.006,0.0058,0.0061,0.0065,0.0066,0.0061,0.0056,0.004,0.0052,0.0055,0.0041,0.0038,0.0032,0.0035,0.0031,0.0028,0.0031,0.0026,0.0024,0.0027,0.0026,0.0025,0.0023,0.0016,0.0019,0.0019,0.0019,0.0014,0.0014,0.0015,0.0016,0.0014,0.001,0.0013,0.0013,0.0011,0.001,0.0011,0.001,0.0011,0.0011,0.00092,0.00079,0.0011,0.001,0.001,0.00067,0.00079,0.001,0.0011],\r\n  \"duration\":6.306500\r\n}\r\n")

(def json-test-data
  (.parse js/JSON json-test-data))

(defn test-data
  "temporary test data, value are close to reality"
  []
  {:left [0.00067 0.00046 0.00055 0.00079 0.00067 0.00067 0.00055 0.3 0.12 0.2 0.3 0.8 0.7 0.002 0.003 0.001]
   :right [0.00055 0.00046 0.00055 0.00055 0.00055 0.00055 0.00046 0.00055 0.00055 0.00055]
   :length 2.12})
  
(defn waveform
  "returns waveform reagent component given noise level input"
  ([amplitude-data]
  (let [amplitude (js->clj amplitude-data)]
    (waveform-svg amplitude)))
  ([]
   (waveform-svg (test-data))))



  
