<!DOCTYPE html>
<html>
  <head>
    <title>Receiver</title>
    <style type="text/css">
    </style>
    <script src='//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js'></script>
    <script src='//kluuu-staging.panter.ch:9293/faye/client.js'></script>
    <script>
      var subscriptions = [];

      var subscribeStream = function(uuid) {
        // TODO subscribe to stream with uuid

        // keep track of what streams already subscribed to
        subscriptions.push(uuid);
      }

      var client = new Faye.Client('http://kluuu-staging.panter.ch:9293/faye');

      // subscribe to streams when they are announced
      client.subscribe('/announce', function(msg) {
        if($.inArray(msg.uuid, subscriptions)) return;
        subscribeStream(msg.uuid);
      });

      // register so streams get reannounced
      client.publish('/register');

      $(function() {
        // send feeback
        $('#send').click(function() {
          var content = $('#content').val();
          client.publish('/feedback', content);
          $('#dialog').prepend('<p>'+content+'</p>');
          $('#content').val('');
        });
      });
    </script>
  </head>

  <body>
    <h1>Receiver</h1>
    <p>Please describe your listening experience.</p>
    <textarea id="content" style='width: 400px; height: 100px'></textarea>
    <br/>
    <button id="send">send</button>
    <div id='dialog'>
    </div>
  </body>
</html>
