- content_for :head do
  = rss_link_tag t('.feed_title', username: @user.name)
  = rss_link_tag t('.listen_later_feed_title', username: @user.name), user_reminders_path(@user, format: 'rss')

- content_for :title do
  = t('.title', username: @user.name)

#main.clearfix{:role => "main"}
  #left-column
    - if current_user && current_user == @user
      #credits.clearfix
        .float-left
          %p
            = t('.you_have_x_credits_left', count: @user.credits).html_safe
        .float-right
          = link_to t('.purchase_more_credits'), :purchases, class: 'button hollow warning'
    #user-block
      
      - if can? :manage, @user
        = link_to [:edit, @user], class: 'button small edit-btn' do
          = icon_tag 'pencil'
          = t('.edit_profile')
      .profile-avatar
        = render partial: "shared/avatar_image_velvet", locals: { user: @user, size: 185 }
      %h3.user-name=@user.name
      %p#user-description
        - if @user.summary.blank? and can? :manage, @user
          = link_to t('.summary_help_text'), [:edit, @user], class: 'button-summary-help'
        - else
          = @user.summary
      %ul.social-links
        -# TODO: link these up, if they have provided the link, show the icon, make it go somewhere
        %li.list-item
          = icon_tag 'twitter'
        %li.list-item
          = icon_tag 'facebook'
        %li.list-item
          = icon_tag 'location'
      - if can? :manage, @user
        -# TODO: discuss. Can't we just have one path to the create talk page?
        -# =link_to new_talk_path, class:'button hollow' do
        -#   = t('.upload_talk') 
        = link_to new_upload_path, class:'button hollow publish-btn' do
          = icon_tag 'megaphone'
          = t('.publish_a_talk') 
      %hr
      -# TODO: make these prettier: put the value big, then underneath, the key in small text 
      %ul.user-meta-group.menu.expanded
        %li
          .text= t('.talks', count: @talks_total)
        %li
          .text= t('.plays', count: @total_plays)
        %li
          = link_to "#series" do
            = t('.series', count: @user.series_without_default.count)
        %li
          = link_to '#listen-later' do
            = t('.listen_later', count: @user.reminders.count)

      -# TODO: are we keeping podcast? if so, make this look and work right...   
      -# else
      -#  %ul.action-links.list-style-type-none
      -#    %li.visitor-view
      -#      = render partial: 'shared/hide_for_anon', locals: { link: link_to_podcast(@user) }
      -# %p.plays-count 
      -#  = t('.plays', count: @total_plays)
      
      %hr/


    #user-about.row
      %p.column-header About
      - unless @user.about.blank?
        %p
          = @user.about_as_html.html_safe
  #right-column.clearfix
    %ul#example-tabs.tabs{"data-tabs" => "g69yge-tabs"}
      %li.tabs-title.is-active{:role => "presentation"}
        %a#pinned-label{"aria-controls" => "pinned", "aria-selected" => "false", :href => "#pinned", :role => "tab"} 
          = t('.listen_later', count: @user.reminders.count)
      - unless @live_talks.empty?
        %li.tabs-title{:role => "presentation"}
          %a#live-label{"aria-controls" => "live", "aria-selected" => "true", :href => "#live", :role => "tab"} 
            = t('.live_talks', count: @live_talks.count)
      %li.tabs-title{:role => "presentation"}
        %a#archived-label{"aria-controls" => "archived", "aria-selected" => "true", :href => "#archived", :role => "tab"} 
          = t('.archived_talks', count: @archived_talks.count)
      %li.tabs-title{:role => "presentation"}
        %a#upcoming-label{"aria-controls" => "upcoming", "aria-selected" => "false", :href => "#upcoming", :role => "tab"} 
          = t('.upcoming_talks', count: @upcoming_talks.count)
      %li.tabs-title{:role => "presentation"}
        %a#series-label{"aria-controls" => "series", "aria-selected" => "false", :href => "#series", :role => "tab"} 
          = t('.series', count: @user.series_without_default.count)
      
    .tabs-content{"data-tabs-content" => "example-tabs"}
      #pinned.tabs-panel.is-active
        - if @remembered_talks.count > 0
          -# TODO: turn this into an inline CTA that appears under certain condiditons. which?
          -##cta-panel{"data-closable" => ""}
          -#  %p
          -#    Would you like to publish your content on Voice Republic?
          -#    %a#cta-button.button{:href => "join.html"} Start Now »
          -#  %button.close-button{"aria-label" => "Dismiss alert", "data-close" => "", :type => "button"}
          -#    %span{"aria-hidden" => "true"} ×
          -# if can? :manage, @user and @user.talks.empty? and @user.participations.empty?
          -# = render partial: "welcome", :locals => { user: @user }
          = render partial: 'shared/talk_card',  collection: @remembered_talks
        - else
          %p.nothing-notice 
            = t('.nothing_pinned')
      - unless @live_talks.empty?
        #live.tabs-panel
          = render partial: 'shared/talk_card', collection: @live_talks
      #upcoming.tabs-panel
        - if @upcoming_talks.count > 0
          -# TODO: make this Talk Card
          = render partial: talks_partial(@upcoming_talks), locals: { color: 'box-slim' }, collection: @upcoming_talks
        - else
          %p.nothing-notice 
            = t('.nothing_scheduled')

      #archived.tabs-panel
        = render partial: 'shared/talk_card', collection: @archived_talks
      #series.tabs-panel
        = render partial: 'shared/series_card', collection: @series

