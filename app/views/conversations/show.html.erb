<%- model_class = Conversation -%>
<% partner = @conversation.partner_of(@user) %>
<div class="page-header">
	<h1><%= t('.your_conversation_with') %> <%= partner.name %></h1>
</div>


<div class="span2">
	<div class="well well-small">
	<%= link_to( user_path(:id => partner)) do %>
	<%= image_tag(partner.account.portrait(:thumb), :class => "img-polaroid") if partner.account.portrait.exists? %>
	<%= partner.name unless partner.account.portrait.exists? %>
	<% end %>
	<br />
	<%= link_to(new_message_path(:receiver_id => partner)) do %>
	<i class="icon-envelope"> </i> <%= t('.new_message') %>
	<% end %>
	</div>
	
	<% @user.conversations.each do |conv| %>
		<% partner = conv.partner_of(@user) %>
		<div class="well well-small">
			<% if current_page?(user_conversation_path(:user_id => @user, :id => conv )) %>
				<%= image_tag(partner.account.portrait(:thumb)) if partner.account.portrait.exists? %>
				<strong><%= partner.name %></strong>
			<% else %>
				<%= image_tag(partner.account.portrait(:thumb)) if partner.account.portrait.exists? %>
				<%= link_to(partner.name, user_conversation_path(:user_id => @user, :id => conv)) %>
			<% end %>
		</div>
	<% end %>
</div>

<div class="span6">

	<% @messages.each do |msg| %>
		<%= partial_for_message(msg, @user) %>
	<% end %>
	
	<%= will_paginate @messages %>
	
	<div class="form-actions">
		<%= link_to t('.back', :default => t("helpers.links.back")),
		user_conversations_path(:user_id => @user), :class => 'btn'  %>
		<%= link_to t('.destroy', :default => t("helpers.links.destroy")),
		user_conversation_path(:user_id => @user, :id => @conversation),
		:method => 'delete',
		:data => { :confirm => t('.confirm', :default => t("helpers.links.confirm", :default => 'Are you sure?')) },
		:class => 'btn btn-danger' %>
	</div>

</div>

