.header-block(style="background-image: url(#{f.object.image.url})"
  data-show-upload="#talk_image,#venue_talks_attributes_0_image")

  .form-top-box.row
    .medium-10.medium-offset-1.columns
      %h2.form-title= form_title

      -#= f.error_messages

      - opts = {}
      - # TODO some fields are protected after state prelive, add this to cancan
      - opts[:disabled] = true unless f.object.prelive?

      = f.input :title, placeholder: t('.title')
      = f.input :teaser, placeholder: t('.teaser')
      = f.input :tag_list, input_html: { class: 'tagList' }

      = f.association :venue, collection: current_user.venues,
        include_blank: t('.create_new_series'),
        input_html: { 'data-on-blank-show' => '#wrapper_new_venue_title' }
      = f.input :new_venue_title, wrapper_html: { id: 'wrapper_new_venue_title' }

      = f.input :language, as: :grouped_select, collection: Talk::LANGUAGES,
        input_html: { class: 'languageSelect' },
        group_method: :last, label_method: :last, value_method: :first

      %br
      %br
      .date-time-picker-row.row.collapse
        .medium-5.columns
          = f.input :starts_at_date, opts.merge(input_html: {'data-picker' => 'date'})
        .medium-4.columns
          = f.input :starts_at_time, opts.merge(input_html: {'data-picker' => 'time'})
        .medium-3.columns
          = f.input :duration, opts.merge(collection: Settings.durations)
      .row.collapse
        .medium-12.columns
          %button.button-standard(type="button" data-trigger-file-input="talk_image")
            = t('.select_image')
          = f.file_field :image, as: :file, class: 'display-none'

      -# BEGIN Angular File Upload
      = f.input :user_override_uuid, as: :hidden
      %div{"ng-show" => "!uploader.isHTML5"}
        = t('.drop_file_not_supported')
      %div{"ng-show" => "uploader.isHTML5"}
        %div
          %h2= t('.audio_upload')
          %div{'ng-class' => "{'highlight-supported-files': addingFailed}"}
            = t('.supported_filetypes')
        -# .well.my-drop-zone{"nv-file-over" => "", :uploader => "uploader"}
        -#   = t('.drop_files_here')
      %input{:multiple => "single", "nv-file-select" => "", :type => "file", :uploader => "uploader"}/
      %ul
        -# The queue for us is only '1', but iteration is still needed, since
        -# it's a multi file uploader
        %li{"ng-repeat" => "item in uploader.queue"}
          .progress
            %span.meter{"ng-style" => "{ 'width': item.progress + '%' }"}
          %div
            %button{"ng-click" => "item.remove()", "ng-disabled" => "!item.isUploading"}= t('.remove')
      #audio_upload_error{"ng-show" => "audioUploadFailed"}
        = t('.upload_failed')
      -# END Angular File Upload

.row
  .medium-12.columns
    %br
    = f.input :guest_list, opts.merge(input_html: { class: 'guestList' })
    %br
    %br
    %label(for="venue_description")
      = t('.talks_description')
    = f.text_area :description, required: true, class: 'ckeditor', input_html: { ckeditor: { toolbar: 'Full' } }
    - messages = f.object.errors.get(:description)
    - unless messages.empty?
      %small.error= messages * ', '
    %br
    = f.input :collect, label: t('.record')

:javascript
  window.unprocessed_upload = #{t('.unprocessed_upload').inspect};
  window.talk_uuid = "#{SecureRandom.uuid}";
  window.talk_upload_url = "#{@presigned_s3_post_url}";
